<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>DogCamp Hashtag & Permissions Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
 
  <!-- (선택) Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="DogCamp Hashtag & Permissions Demo" />
  <meta property="og:description" content="Internal demo for instagram_basic, pages_show_list, pages_read_engagement, and Instagram Public Content Access, used only for DogCamp’s own accounts and event hashtags." />
  <meta property="og:url" content="https://seraphicboy.github.io/dogcamp-hashtag-demo/hashtag-demo.html" />
  <meta property="og:image" content="https://seraphicboy.github.io/dogcamp-hashtag-demo/dogcamp-og-image.png" />
  <meta property="fb:app_id" content="1668676324517166" />

  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color-scheme: dark;
      background-color: #020617;
      color: #e5e7eb;
    }
    body {
      margin: 0;
      padding: 24px 10px 40px;
      background: radial-gradient(circle at top, #1f2937, #020617 55%);
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 4px;
    }
    .subtitle {
      font-size: 13px;
      color: #9ca3af;
      margin-bottom: 20px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
      align-items: flex-start;
    }
    .card {
      padding: 16px 14px 18px;
      border-radius: 16px;
      border: 1px solid #1f2937;
      background: #020617;
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.7);
    }
    .card h2 {
      font-size: 16px;
      margin: 0 0 6px;
    }
    .card p {
      font-size: 13px;
      line-height: 1.6;
      margin: 4px 0;
    }
    label {
      display: block;
      font-size: 12px;
      margin-top: 6px;
      margin-bottom: 2px;
      color: #9ca3af;
    }
    input[type="text"] {
      width: 100%;
      padding: 7px 8px;
      border-radius: 10px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 13px;
    }
    textarea {
      width: 100%;
      min-height: 80px;
      padding: 7px 8px;
      border-radius: 10px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      resize: vertical;
    }
    .btn {
      margin-top: 8px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      background: #3b82f6;
      color: white;
    }
    .btn:hover {
      background: #2563eb;
    }
    .section-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #9ca3af;
      margin-bottom: 4px;
    }
    .small {
      font-size: 12px;
      color: #9ca3af;
    }
    code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      background: #020617;
      padding: 1px 4px;
      border-radius: 4px;
      border: 1px solid #1f2937;
    }
    .result-box {
      margin-top: 8px;
      font-size: 12px;
      background: #020617;
      border-radius: 10px;
      border: 1px solid #1f2937;
      padding: 8px;
      max-height: 150px;
      overflow: auto;
      white-space: pre-wrap;
    }
    .api-log {
      margin-top: 24px;
      padding: 14px 12px;
      border-radius: 16px;
      border: 1px solid #1f2937;
      background: #020617;
    }
    .api-log h2 {
      font-size: 15px;
      margin: 0 0 6px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>DogCamp Hashtag & Permissions Demo</h1>
    <div class="subtitle">
      Internal review demo for Meta permissions:
      <code>instagram_basic</code>,
      <code>pages_show_list</code>,
      <code>pages_read_engagement</code>,
      <code>Instagram Public Content Access</code>.<br />
      Used only for our own business accounts and DogCamp event hashtags
      (e.g. <code>#도그캠프공항점</code>, <code>#2023트리샷이벤트</code>,
      <code>#2024트리샷이벤트</code>, <code>#2025트리샷이벤트</code>).
    </div>

    <!-- STEP 0: Token & IDs -->
    <div class="card">
      <div class="section-title">Step 0 – Access token & IDs (review environment)</div>
      <p>
        For this review, please paste a <strong>user access token</strong> that has:
        <code>instagram_basic</code>, <code>pages_show_list</code>,
        <code>pages_read_engagement</code>, and
        <code>Instagram Public Content Access</code>
        for our DogCamp assets.
      </p>
      <p class="small">
        In our real internal environment, tokens are handled on the server side,
        are never shown to customers, and are used only by DogCamp staff
        for our own Business accounts.
      </p>

      <label for="access-token">User access token (for review)</label>
      <input id="access-token" type="text" placeholder="Paste Graph API Explorer token here" />

      <label for="ig-user-id">Instagram Business Account ID (ig_user_id)</label>
      <input id="ig-user-id" type="text" value="17841451651429958" />

      <label for="page-id">Facebook Page ID (DogCamp)</label>
      <input id="page-id" type="text" value="100541009374926" />
    </div>

    <div class="grid" style="margin-top: 18px;">
      <!-- instagram_basic -->
      <div class="card">
        <div class="section-title">1. instagram_basic</div>
        <h2>Our own Instagram Business account</h2>
        <p>
          This section uses <code>instagram_basic</code> to call:
          <code>/{ig-user-id}?fields=id,username,media_count</code>
          and show only our own Business account data.
        </p>

        <button class="btn" id="btn-ig-basic">
          Load IG Business info
        </button>

        <div id="ig-basic-result" class="result-box">
          Result will appear here.
        </div>
      </div>

      <!-- pages_show_list -->
      <div class="card">
        <div class="section-title">2. pages_show_list</div>
        <h2>List our Facebook Pages</h2>
        <p>
          This section uses <code>pages_show_list</code> to call:
          <code>/me/accounts?fields=id,name</code>.
        </p>
        <p class="small">
          We only use this list to confirm and select our own Page
          <strong>도그캠프 공항점</strong>, not pages of other businesses.
        </p>

        <button class="btn" id="btn-pages-list">
          List my Facebook Pages
        </button>

        <div id="pages-list-result" class="result-box">
          Result will appear here.
        </div>
      </div>

      <!-- pages_read_engagement -->
      <div class="card">
        <div class="section-title">3. pages_read_engagement</div>
        <h2>Basic engagement for our Page</h2>
        <p>
          This section uses <code>pages_read_engagement</code> to call:
          <code>/{page-id}/posts?fields=id,message,created_time,permalink_url,insights.metric(post_impressions).period(lifetime)</code>.
        </p>
        <p class="small">
          We use this only to see impressions and engaged users for our own
          DogCamp Page posts, so we can improve our event and announcement posts.
        </p>

        <label for="page-id-eng">Page ID for engagement</label>
        <input id="page-id-eng" type="text" value="100541009374926" />

        <button class="btn" id="btn-pages-engagement">
          Load Page posts + engagement
        </button>

        <div id="pages-engagement-result" class="result-box">
          Result will appear here.
        </div>
      </div>

      <!-- Instagram Public Content Access (hashtag) -->
      <div class="card">
        <div class="section-title">4. Instagram Public Content Access</div>
        <h2>Event hashtag posts (recent_media)</h2>
        <p>
          This section uses <strong>Instagram Public Content Access</strong> to:
        </p>
        <ul class="small">
          <li>Call <code>ig_hashtag_search?user_id={ig-user-id}&amp;q={event-hashtag}</code> to get the hashtag ID.</li>
          <li>Then call <code>/{hashtag-id}/recent_media?user_id={ig-user-id}&amp;fields=id,caption,media_type,media_url,permalink,timestamp</code>.</li>
        </ul>
        <p class="small">
          We only search our own brand/event hashtags, such as
          <code>도그캠프공항점</code>, <code>2023트리샷이벤트</code>,
          <code>2024트리샷이벤트</code>, <code>2025트리샷이벤트</code>.
          This is used only to confirm which customers joined in-store events and
          to manually re-share some posts on <strong>@dogcamp.gochon</strong>
          with proper credit.
        </p>

        <label for="hashtag-input">Event hashtag (without #)</label>
        <input id="hashtag-input" type="text" placeholder="예: 2025트리샷이벤트" />

        <button class="btn" id="btn-hashtag-search">
          Search hashtag posts (recent_media)
        </button>

        <div id="hashtag-result" class="result-box">
          Result will appear here.
        </div>
      </div>
    </div>

    <!-- API log -->
    <div class="api-log">
      <h2>API log (requests &amp; responses)</h2>
      <p class="small">
        For review, this log shows the exact Graph API URLs and JSON responses
        used by each section above.
      </p>
      <textarea id="api-log" readonly>
API log will appear here.
      </textarea>
    </div>
  </div>

  <script>
    const GRAPH_VERSION = "v24.0";

    function getToken() {
      const token = document.getElementById("access-token").value.trim();
      if (!token) {
        alert("Please paste a user access token in Step 0.");
        return null;
      }
      return token;
    }

    function log(message) {
      const logEl = document.getElementById("api-log");
      const time = new Date().toISOString();
      const prev = logEl.value.trim() === "API log will appear here." ? "" : logEl.value + "\n";
      logEl.value = prev + "[" + time + "] " + message;
      logEl.scrollTop = logEl.scrollHeight;
    }

    async function fetchWithLog(url, options = {}) {
      log("REQUEST: " + url);
      try {
        const res = await fetch(url, options);
        const text = await res.text();
        log("RESPONSE (" + res.status + "): " + text);
        let json;
        try {
          json = JSON.parse(text);
        } catch {
          json = { raw: text };
        }
        return json;
      } catch (err) {
        log("ERROR: " + err.message);
        throw err;
      }
    }

    // 1) instagram_basic
    document.getElementById("btn-ig-basic").addEventListener("click", async () => {
      const token = getToken();
      if (!token) return;

      const igUserId = document.getElementById("ig-user-id").value.trim();
      if (!igUserId) {
        alert("Please enter ig_user_id in Step 0.");
        return;
      }

      const url = `https://graph.facebook.com/${GRAPH_VERSION}/${igUserId}?fields=id,username,media_count&access_token=${encodeURIComponent(token)}`;
      const resultBox = document.getElementById("ig-basic-result");
      resultBox.textContent = "Loading...";
      try {
        const data = await fetchWithLog(url);
        resultBox.textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        resultBox.textContent = "Error. See API log below.";
      }
    });

    // 2) pages_show_list
    document.getElementById("btn-pages-list").addEventListener("click", async () => {
      const token = getToken();
      if (!token) return;

      const url = `https://graph.facebook.com/${GRAPH_VERSION}/me/accounts?fields=id,name&access_token=${encodeURIComponent(token)}`;
      const resultBox = document.getElementById("pages-list-result");
      resultBox.textContent = "Loading...";
      try {
        const data = await fetchWithLog(url);
        resultBox.textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        resultBox.textContent = "Error. See API log below.";
      }
    });

    // 3) pages_read_engagement
    document.getElementById("btn-pages-engagement").addEventListener("click", async () => {
      const token = getToken();
      if (!token) return;

      const pageId = document.getElementById("page-id-eng").value.trim();
      if (!pageId) {
        alert("Please enter the Page ID for engagement.");
        return;
      }

      const url = `https://graph.facebook.com/${GRAPH_VERSION}/${pageId}/posts?fields=id,message,created_time,permalink_url,insights.metric(post_impressions).period(lifetime)&limit=5&access_token=${encodeURIComponent(token)}`;
      const resultBox = document.getElementById("pages-engagement-result");
      resultBox.textContent = "Loading...";
      try {
        const data = await fetchWithLog(url);
        resultBox.textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        resultBox.textContent = "Error. See API log below.";
      }
    });

    // 4) Instagram Public Content Access – hashtag search
    document.getElementById("btn-hashtag-search").addEventListener("click", async () => {
      const token = getToken();
      if (!token) return;

      const igUserId = document.getElementById("ig-user-id").value.trim();
      const hashtag = document.getElementById("hashtag-input").value.trim();
      const resultBox = document.getElementById("hashtag-result");

      if (!igUserId) {
        alert("Please enter ig_user_id in Step 0.");
        return;
      }
      if (!hashtag) {
        alert("Please enter an event hashtag (without #).");
        return;
      }

      resultBox.textContent = "Searching hashtag ID...";
      try {
        // 1) ig_hashtag_search
        const searchUrl = `https://graph.facebook.com/${GRAPH_VERSION}/ig_hashtag_search?user_id=${encodeURIComponent(igUserId)}&q=${encodeURIComponent(hashtag)}&access_token=${encodeURIComponent(token)}`;
        const searchData = await fetchWithLog(searchUrl);

        if (!searchData.data || !searchData.data.length) {
          resultBox.textContent = "No hashtag ID found for this query.";
          return;
        }

        const hashtagId = searchData.data[0].id;
        resultBox.textContent = "Found hashtag ID: " + hashtagId + "\nLoading recent_media...";

        // 2) recent_media
        const mediaUrl = `https://graph.facebook.com/${GRAPH_VERSION}/${hashtagId}/recent_media?user_id=${encodeURIComponent(igUserId)}&fields=id,caption,media_type,media_url,permalink,timestamp&limit=10&access_token=${encodeURIComponent(token)}`;
        const mediaData = await fetchWithLog(mediaUrl);
        resultBox.textContent = JSON.stringify(mediaData, null, 2);
      } catch (e) {
        resultBox.textContent = "Error. See API log below.";
      }
    });
  </script>
</body>
</html>
